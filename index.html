<!DOCTYPE html>
<html>
<head>
	<title>Tic Tac Toe Vs AI</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>


	<script type="text/javascript">
	
		var turn = 0;
		var winningCombinations;
		var possibleWins;
		var painted;
		var content;
		var isWinner = false;
		var possibleNumbersToChooseFrom = [];


		$(document).ready(function(){
		    painted = new Array();
		    content = new Array();
		    possibleWins = [];
		    winningCombinations = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
		    // possibleWins = [true, true, true, true, true, true, true, true]

		// Create board
			for (var i = 0; i < 9; i++) {
				$('#board').append('<div class="box" id="box'+ i +'"></div>');
			}

		// create arrays with empty values
			function createArrays() {
			    for(var l = 0; l <= 8; l++){
				    painted[l] = false;
				    content[l]='';
			    }
			    for (var m = 0; m < 8; m++) {
				    possibleWins[m] = true;
			    }
			}
			createArrays();

		// when box is clicked
			$('.box').click(function(event) {
				var xChooses = $(".box").index(this);
				// alert("That was div index #" + xChooses);
				if(isWinner==false){
					if(turn < 9) {
						boxClicked(xChooses);
					}
				}
			});

			$("#startover").click(function() {
				isWinner = false;
				turn = 0;
				createArrays();
				$('.box').removeClass('red');
				$('.box').removeClass('blue');
			});
		});


		// User's Turn
		function boxClicked(boxNumber) {
		    theBox = "box"+boxNumber;


			if (painted[boxNumber] == false) { // this condition tell us if the box is empty then...
				turn++;

				painted[boxNumber] = true;
        		content[boxNumber] = 'X';
        		$('#' + theBox).addClass("red");

				checkForWinners("X");

				// put this here because if user clicks an already filled box it count's as a turn and the AI fills a box.
				if(isWinner==false){
					if(turn==9) {
						alert("The Game is over");
					}
					else {
						console.log("X chooses..." +boxNumber);
						aiLookingToWin(boxNumber);
						if (typeof possibleNumbersToChooseFrom !== 'undefined' && possibleNumbersToChooseFrom.length > 0) {
    						// the array is defined and has at least one element

							// write a function that passes in the xChooses
							aiTurn(aiLookingToWin(boxNumber));
						}
						else {
							var randomNumber = Math.floor(Math.random() * 9);
							console.log("comp is choosing randomNumber " + randomNumber);
							aiTurn(randomNumber);
							
						}

					}
				}

			}
			else {
				alert("That Space is already filled");
			}

		}

		// AI needs to look for when it's close to winning. 
				// MAYBE:
				// create an array of possible wins left (true/false)
				// once X chooses a number change those possibilities to false
				// have O choose a number out of the possible winning combinations.
		function aiLookingToWin(userBoxPosition) {
			for (var z = 0; z < 8; z++) {
				if (winningCombinations[z][0] == userBoxPosition || winningCombinations[z][1] == userBoxPosition || winningCombinations[z][2] == userBoxPosition) {
					possibleWins[z] = false;
				}
			}

			// clear array of numbers that have a possible win
			possibleNumbersToChooseFrom = [];
			for (var y = 0; y < possibleWins.length; y++) {
				if (possibleWins[y] == true) {
					// console.log(winningCombinations[y]);
					for (var x = 0; x <= 2; x++) {
						possibleNumbersToChooseFrom.push(winningCombinations[y][x]);
					}
				}
			}
			// loop through possible numbers and have AI choose one of those numbers
			console.log("choose from" +possibleNumbersToChooseFrom);
			
			var random = Math.floor(Math.random() * possibleNumbersToChooseFrom.length);
			var aiThoughtOutNumber = possibleNumbersToChooseFrom[random];
			console.log("AI chooses " + aiThoughtOutNumber);
			return aiThoughtOutNumber;
		}


		function aiTurn(boxNumber) {

			if (painted[boxNumber] == false) { // this condition tell us if the box is empty then...
				turn++;

				content[boxNumber] = "O";
				painted[boxNumber] = true;
				$('#box' + boxNumber).addClass("blue");

				checkForWinners("O");
			}
			else {
				// but if the box has been filled that comp needs to choose another box to fill
				console.log(boxNumber + "is already filled");
				aiTurn(aiLookingToWin());
			}
		}


		function checkForWinners(symbol) {
		    for(var a = 0; a < winningCombinations.length; a++) {
			    if(content[winningCombinations[a][0]]==symbol && content[winningCombinations[a][1]]== symbol && content[winningCombinations[a][2]]==symbol) {
			        alert(symbol+ " WON!");
			        isWinner = true;
			    }
		    }
		}


	</script>
</head>
<body>
	<h1>Tic Tac Toe</h1>
	<div id="board"></div>
	<button id="startover">Start Over</button>
</body>



<!-- Users Turn -->
<!-- Box gets clicked that Nubmer is called xChooses -->
<!-- after the users box is fille and marked, the AI's turn is started -->

<!-- AI Turn -->
<!-- xChooses -->





</html>